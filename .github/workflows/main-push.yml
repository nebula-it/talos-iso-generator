name: Create new talos ISO with DRBD
# on:
#   release:
#     types: [created]
on: push
permissions:
  contents: write
  discussions: write
env:
  TALOS_VERSION: ''
  # DRBD_IMAGE_VERSION: ${{ github.event.release.tag_name }}
  DRBD_IMAGE_VERSION: '9.2.4-v1.5.1'
jobs:
  Build:
    name: Build new image
    runs-on: ubuntu-latest
    steps:
      - name: Get Talos Version
        shell: pwsh
        run:${{$env.TALOS_VERSION}} = ${{env.DRBD_IMAGE_VERSION}}.Split('-')[-1]
    #   - name: Build new image
    #     run: docker run --rm -t -v $PWD/_out:/out -v /dev:/dev --privileged ghcr.io/siderolabs/imager:$TALOS_VERSION iso --system-extension-image ghcr.io/siderolabs/drbd:DRBD_IMAGE_VERSION
    #   - name: Release
    #     uses: softprops/action-gh-release@v1
    #     if: startsWith(github.ref, 'refs/tags/')
    #     with:
    #       # tag_name: 0.0.3
    #       # body: 'Test'
    #       files: |
    #         ./_out/metal-amd64.iso
      # - name: Test Shell
      #   run: echo $SHELL
      - name: Var Github Ref
        id: reference
        shell: pwsh
        run: Write-Host ${{ env.DRBD_IMAGE_VERSION }}
      # - name: Set var
      #   run: pwsh -c "$env:test = 'abc'"
      - name: Get var
        shell: pwsh
        run: Write-Host ${{ env.TALOS_VERSION }}
      # - name: Var github.event.release.tag_name
      #   run : pwsh -c "Write-Host ${{ github.event.release.tag_name }}"
            
